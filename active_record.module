<?php
/**
 * Functionally, this drupal module provides an Active Record style way of accessing drupal objects.
 * It also provides more complicated functionality, as versionable custom objects, and a search-builder.
 * @author Matthew Baggett <matthew@baggett.me>
 */

require_once("lib/pretty_print_json.inc");
require_once("lib/query_log.inc");

// Load core of Active Record module.
require_once("lib/active_record.php");
require_once("lib/versioned_active_record.php");

// Load searcher
require_once("lib/search.php");
require_once("lib/search_condition.php");

// Load dumb modeler
require_once("lib/dumb_model.php");

// Load core Models
require_once("models/role.inc");
require_once("models/user_role.inc");
require_once("models/user.inc");

function active_record_permission()
{
    return array(
        "version control" => array('title' => t("Have Version Control")),
        "view queries" => array('title' => t("View Queries"))
    );
}

function active_record_has_version_permission()
{
    return active_record_check_permission('version control');
}

function active_record_check_permission($permission)
{
    global $user;
    return user_access($permission, $user);
}

function active_record_block_view($delta = '') {
    $block = array();
    switch ($delta) {
        case 'query-log':
            $block['subject'] = t('Active Record Query Log');
            $block['content'] = query_log::render();
            return $block;
    }
}

function active_record_block_info() {
    $blocks['query-log'] = array(
        'info' => t('Active Record Query Log'),
        'cache' => DRUPAL_NO_CACHE,
    );
    return $blocks;
}
